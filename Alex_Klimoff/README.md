# Домашнее Задание 05.GIT
### Создайте у себя на локальной машине Git репозиторий со следующими ветками:
##### master - в ней 2 коммита
##### staging - в ней 2 коммита из master + 2 дополнительных
##### test - в ней 2 коммита из master + 2 дополнительных из staging + 1 дополнительный
##### fix/prod_is_down - в ней 2 коммита из master + 1 дополнительный
##### Переходим в ветку мастер и создаём ветку production для релиза 
##### Делаем слияние с веткой test т.к. в ней уже есть все коммиты из staging, с master коммиты автоматически подтянулись т.к. мы создавались из мастера 
##### Переходим на ветку fix/prod_is_down, создаём оттуда ветку fix_prod и делаем слияние с веткой test, т.к. в ветке тес находяться все коммиты из ветки master и staging
##### Итого у нас есть ветка production которая соответствует ТЗ "Релиз в production - все коммиты должны быть в ветке master (кроме коммитов в ветке fix/prod_is_down)" и ветка fix_prod которая соответсвует ТЗ "Развертывание fix - коммит из ветки fix/prod_is_down должен быть во всех ветках"

# Домашнее Задание 06.BASH
###  Задание №1 "Посчитать количество странных слов в ядре Linux" ядро взято linux-5.16.11, распакованно в одноименную папку
###  Основная команда для поиска слов в папке "grep -r -o -i  "слово которое ищем" | wc -w " 
###   На основании этой команды сделано 2 скрипта: 
#####  ticket - просто ищет заданные слова в указанной папке 
#####  ticket_1 - спрашивает какое слово искать и потом ищет его в указанной в скрипте папке
 
###   Задание №2 "10 самых больших файлов в директории" будем делать опять на распакованном ядре linux-5.16.11
###  Основная команда для поиска 10 самых больших файлов в директории "find /linux-5.16.11 -printf '%s %p\n'| sort -nr | head -10 " выведет на экран 10 самых больших файлов в директории...
### Если надо вывод в файл - добавить в конце > file.txt "find /linux-5.16.11/ -printf '%s %p\n'| sort -nr | head -10 > result.txt"

# Домашнее Задание 07.Docker
### Ссылка на образ на docker hub https://hub.docker.com/layers/196173967/klimoff/belhard/latest/images/sha256-ed1fa64961eaeabdfc54f22cdfb37fade998005d8a5d5e4d7022296f13bee312?context=repo
### вывод содержимого Dockerfile и entrypoint.sh прикладываю в TXT файле output.txt

# Домашнее Задание 08.Nginx
### В директории 08.Nginx созданы 2 директории 1 и 2 для разных докерфайлов с содержимым Dockerfile и index.html
### Переходим в папки 1 и 2 по очереди запускаем оба докер файла коммандой docker build .  -t www1 и docker build .  -t www2
### Устанавливаем nginx коммандой apt update && apt install nginx, меняем содержимое файла /etc/nginx/sites-available/default (измененный файл прилагается)
### Запускаем оба контейнера коммандой docker run -d -p 8100:80 www1 && docker run -d  -p 8200:80 www2
# Доп Задание сделать все тоже самое, только используя docker-compose и кастомную сеть
### Создал папку 08.5.Nginx, скопировал туда содержимое папки 08.Nginx, установил docker-compose на хост системе, создал yml файл для запуска docker-compose, в нем прописал запуск обоих докер файлов и кастомнуб сеть 172.28.0.0/24
###  Запускаем docker-compose build && docker swarm init && docker-compose up

# Домашнее Задание 09.PostgreSQL

### Создаём папку 09.PostgreSQL, создаю скрипт для запуска контейнеров script (сам скрипт запуска прилагается)
### Командой docker ps -a смотрим ид контейнера postgres сервера  и входим в его терминал docker exec -it CONTAINER_ID /bin/bash, там вводим комманды:
##### psql -U postgres
##### CREATE DATABASE belhard;
##### \c belhard
##### CREATE TABLE devops
#####(
#####    Id SERIAL PRIMARY KEY,
#####    FirstName CHARACTER VARYING(30),
#####    LastName CHARACTER VARYING(30),
#####    Email CHARACTER VARYING(30),
#####    Age INTEGER
#####);
##### Заполняем таблицу devops данными (12 строк) и выходим с бд командой \q
##### В терминале выполняем apt update && apt install mc ssh -y 
##### Делаем дамп всей БД коммандой pg_dumpall > dump_all
##### С помощью mc копируем по ssh файл на хост систему
##### Запускаем еще 1 контейнер с postgresql docker run  -p 5433:5432 -d -e POSTGRES_HOST_AUTH_METHOD=trust postgres, заходим аналогично первого контейнера на него и устанавливаем mc и ssh
##### Копируем с хост системы файл dump_all в папку /home и восстанавливаем БД командой psql -U postgres -f /home/dump_all postgres
##### Заходим в pgadmin, делаем новое подключени на порт 5433 и сравниваем 2 сервера , проверяем наличие БД belhard  и наличие данных в таблице devops  

# Домашнее Задание 10.Terraform
### Создаём 4 файла main.tf  provader.tf  res.tf  variables.tf
#####  main.tf - описание VM
#####  provader.tf - описание провайдера
#####  res.tf - параметры конфигурации  
#####  variables.tf - описание переменных
### Дополнительно создана папка docker там скопированы файлы из домашнего задания  08.Nginx
##### Созданы файлы  docker.tf    main.tf      provader.tf 
##### main.tf - описание VM
##### provader.tf - описание провайдера
##### docker.tf - параметры и ключи запуска контейнеров docker

# Домашнее Задание 11.Ansible
###  
##### Подняты 3 виртуальные машины (использовано из прошлого ДЗ по Terraform)
##### Установил на одну из них Ansible и изменил hostname на ansible-master
##### На остальных двух виртуальных машинах изменил hostname на ansible-1 и ansible-2
##### сгенерировал на ansible-master новую пару SSH ключей
##### Закинул public ключ на ansible-1 и ansible-2 и проверил, что можно подключиться по SSH с ansible-master на ansible-1 и ansible-2
##### Создаём файлы для ansible hosts.yml     playbook.yml
##### hosts.yml - описание хостов (ansible-1 и ansible-2)
##### playbook.yml сам плейбук в котором создается группа devops и пользователь belhard на ansible-1 и ansible-2, устанавливаются пакеты curl, wget, unzip, zip на ansible-1 и ansible-2, устанавливается Java 11 на ansible-1, устанавливается nginx на ansible-2
### Дополнительно создана папка docker в которой созданы файлы  hosts.yml     playbook.yml  vars.yml     
##### hosts.yml  - описание хостов (ansible-1 и ansible-2)
##### vars.yml - переменные для плейбука
##### playbook.yml сам плейбук который обновляет апт, устанавливает транспортные пакеты и  ключи репозиториев докера, устанавливает докер с зависимостями из репозитория, добвляет пользователя в группу docker для запуска докера без судо, стягивает образ с docker-hub и запускает его на всех хостах   

# Домашнее Задание 12.Jenkins
##
#### Установлен Jenkins
##### Подключил к нему 2 ноды slave-1 и slave-2
##### Написал 2 Jenkinsfile:
### Первый:
##### запускается только на slave-1, подтягивается с докерхаба образ из ДЗ 07.Docker, запускается и устанавливаются пакеты curl, wget, git, bash, speedtest-cli
##### клонируется мой репозиторий
##### показывает список файлов в репозитории
##### отдельной коммандой потом запускается speedtest-cli
### Второй:
### Jenkinsfile подтягивается из гитхаба и  запускается локально на слейве (master) 
##### вытягивает и запускает Docker контейнер из ДЗ 07.Docker
##### показывает вывод docker ps -a
##### Дополнительно в jenkinsfile1 в 37 строке curl-ом отправляется сообщение в телеграмм канал klimoff_bot о успешном выполнении JOB 

# Домашнее Задание 13.K8S
##### Устанавливаем миникуб, запускаем коммандой minikube start --vm-driver=kvm2, в папке klimoff лежит helm чарт для деплоя контейнера из ДЗ по Docker, запуск командой kubectl create namespace klimoff &&  helm install klimoff-helm klimoff/ --values /klimoff/values.yaml -n klimoff
##### После успешного тестирования helm папка klimoff с helm чартом загружена в гит, она используется для доп задания
##### Для доп задания был сделан Jenkinsfile который лежит в папке dop он обновляет апт, устанавливает необходимые пакеты, устанавливает на виртуальную машину minikub, kubectl клонирует папку klimoff с Github в локальную директорию и запускает протестированный helm чарт на ноде ansible-1 
 
